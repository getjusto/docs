openapi: 3.0.0
info:
  title: StockMethods API
  version: 1.0.0
servers:
  - url: https://api.getjusto.com/api/v1
    description: Production server
tags:
  - name: Agotar un producto o modificarlo
    description: Manejo de productos
paths:
  /addOutOfStockItem:
    post:
      tags:
        - StockMethods
      summary: Agotar un producto o modificarlo
      description: Este endpoint se utiliza cuando se quiere modificar o agotar un producto.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                storeId:
                  type: string
                  description: ID del local. Se puede utilizar el `externalId`.
                productId:
                  type: string
                  description: ID del Producto. Se puede utilizar el `externalId`. 
                modifierId:
                  type: string
                  description: ID del Modificador. Se puede utilizar el `externalId`.
                modifierOptionId:
                  type: string
                  description: ID de la opción del Modificador. Se puede utilizar el `externalId`.
                untilDate:
                  type: string
                  format: date-time
                  description: Fecha hasta la que estará agotado el producto. Formato ISO_8601
                type:
                  type: string
                  description: Tipo de producto a agotar. Puede ser `product` o `modifier`.
                  enum: ['product' , 'modifier']  
              required:
              - storeId
              - type
              - unitelDate
              oneOf:
              - required: ['productId']
              - required: ['modifierId', 'modifierOptionId']
      responses:
        '200':
          description: Operación exitosa
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    description: Estado operacion
                    example: ok
                  data:
                    type: object
                    properties:
                      _id: 
                        type: string
                        description: ID del item.
                        example: erCB5SjdcopHCLTfk
                      store:
                          type: object
                          description: Modificador.
                          properties:
                            _id:
                              type: string
                              description: ID del item.
                              example: Li4eEa3W2hiuGGCFa
                            name:
                              type: string
                              description: Nombre del Modificador.
                              example: Colón
                            externalId:
                              type: string
                              description: ID externo indicado en la información del Modificador.
                              example: pupi
                      modifier:
                        type: object
                        description: Modificador.
                        properties:
                          _id:
                            type: string
                            description: ID del item.
                            example: XS3wWdedwKRRYrZZt
                          name:
                            type: string
                            description: Nombre del Modificador.
                            example: ¿Necesitas ayuda para los palitos?
                          externalId:
                            type: string
                            description: ID externo indicado en la información del Modificador.
                            example: null
                      modifierOption:
                        type: object
                        description: Modificador.
                        properties:
                          _id:
                            type: string
                            description: ID del item.
                            example: Na4Ha7ShFbDsvcRKg
                          name:
                            type: string
                            description: Nombre del Modificador.
                            example: Si
                          externalId:
                            type: string
                            description: ID externo indicado en la información del Modificador.
                            example: null
                      type: 
                        type: string
                        description: Tipo de item.
                        example: modifier
                      until:
                        type: string
                        description: Dia De cuando llega el pedido.
                        example: tomorrow
                      untilDate:
                        type: string 
                        format: date-time
                        description: Fecha máxima en que el producto estará vencido.    
                        example: 2020-07-30T10:00:00.000Z
                      websiteId: 
                        type: string
                        description: ID del website.
                        example: ErCkmcyCEovseJq5E
                      createdAt:
                        type: string 
                        format: date-time
                        description: Fecha en la que se creo el pedido.    
                        example: 2020-07-29T14:14:33.347Z
        '401':
          description: Access token is missing or invalid

  /deleteOutOfStockItem:
    post:
      tags:
        - StockMethods
      summary: Eliminar múltiples productos agotados
      description: Este endpoint permite eliminar múltiples productos previamente marcados como agotados.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                outOfStockItemId:
                  type: string
                  description: ID del item agotado. Este ID es el retornado en el método `addOutOfStockItem`.
              required:
                - outOfStockItemId
      responses:
        '200':
          description: Operación exitosa
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    description: Estado de la operación
                  data:
                    type: boolean
                    description: Resultado de la operación (true si se eliminó con éxito)
        '401':
          description: Access token is missing or invalid


  /deleteOutOfStockItems:
    post:
      tags:
        - StockMethods
      summary: Eliminar múltiples productos agotados
      description: Este endpoint permite eliminar múltiples productos previamente marcados como agotados.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                items:
                  type: array
                  description: Un ítem es representado por el id retornado por los métodos `addOutOfStockItems` o `addOutOfStockItem`. Este arreglo tiene como límite 4000 elementos, sobre este número se rechazará la llamada.
                  items:
                    type: object
                    properties:
                      outOfStockItemId:
                        type: string
                        description: ID retornado por los métodos addOutOfStockItems o addOutOfStockItem
              required:
                - items
      responses:
        '200':
          description: Operación exitosa
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    description: Arreglo que contiene true por cada producto/modificador(outOfStockItemId) que vuelve a stock.
                    items:  
                      type: object
                      properties:
                        outOfStockItemID:
                          type: string
                          description: ID del producto procesado.
                        result:
                          type: boolean
                          description: Estado del producto
                  errors:
                    type: array
                    description: Lista de errores que ocurrieron durante la operación
                    items:
                      type: object
                      properties:
                        outOfStockItemId:
                          type: string
                          description: ID del producto relacionado con el error
                        message:
                          type: string
                          description: Mensaje de error
        '401':
          description: Access token is missing or invalid



  /outOfStockItems:
    post:
      tags:
        - StockMethods
      summary: Obtener productos agotados
      description: Este endpoint se utiliza cuando se quiere obtener los productos agotados.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                storeId:
                  type: string
                  description: Requerido si `storeIds` no está definido. ID del local o nombre del local
                storeIds:
                  type: array
                  items:
                    type: string
                  description: Requerido si `storeId` no está definido. Arreglo de strings con los IDs de los locales o con los nombres de los locales
              oneOf:
                - required: ["storeId"]
                - required: ["storeIds"]
      responses:
        '200':
          description: Operación exitosa
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                  data:
                    type: array
                    items:
                      properties:
                        _id:
                          type: string 
                          description: Id del producto agotado.
                        type:
                          type: string
                          description: Tipo del item agotado
                        websiteId:
                          type: string
                          description: Id del sitio asociado
                        productId:
                          type: string
                          description: ID del producto.
                        productExternalId:
                          type: string
                          description: ID externo del producto.
                        storeId: 
                          type: string
                          description: Id del locar donde se encuentra agotado el producto
                        createdAt: 
                          type: string
                          format: date-time
                          description: Fecha de creacion
                        until:
                          type: string
                          format: date-time
                          description: Dia hasta la que se encontrara agotado.
                        untilDate: 
                          type: string
                          format: date-time
                          description: Fecha hasta la que se encontrara agotado 
        '401':
          description: Access token is missing or invalid

  /setOutOfStockItems:
    post:
      tags:
        - StockMethods
      summary: Definir stock de productos
      description: Este endpoint se utiliza para modificar el stock de un producto.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                type: object
                properties:
                  storeId:
                    type: string
                    description: ID del local. Se puede utilizar el `externalId`.
                  productId:
                    type: string
                    description: ID del Producto. Se puede utilizar el `externalId`.
                  modifierId:
                    type: string
                    description: ID del Modificador. Se puede utilizar el `externalId`.
                  modifierOptionId:
                    type: string
                    description: ID de la opción del Modificador. Se puede utilizar el `externalId`.
                  type:
                    type: string
                    description: Tipo de producto a agotar. Puede ser
                    enum: ['product ', 'modifier']
                  stock:
                    type: integer
                    description: Valor numérico del stock.
                required:
                - storeId
                - type
                - stock
                oneOf:
                  - required: ["productId"]
                  - required: ["modifierId", "modifierOptionId"]
      responses:
        '200':
          description: Operación exitosa
          content:
            application/json:
              schema:
                type: object
                properties:
                  status: 
                    type: string
                    description: Estado de la operacion
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        _id:
                          type: string
                          description: ID del item.
                        store:
                          type: object
                          properties:
                            _id:
                              type: string
                              description: ID de la tienda.
                            name:
                              type: string
                              description: Nombre de la tienda.
                            externalId:
                              type: string
                              description: ID externo de la tienda.
                        modifier:    
                          type: object
                          properties:
                            _id:
                              type: string
                              description: ID del producto.
                            externalId:
                              type: string
                              description: ID externo de la empresa
                            name:
                              type: string
                              description: Nombre de la tienda.
                        modifierOption:    
                          type: object
                          properties:
                            _id:
                              type: string
                              description: ID del producto.
                            name:
                              type: string
                              description: Nombre de la tienda.
                            externalId:
                              type: string
                              description: ID externo de la empresa
                        type:
                          type: string
                          description: Tipo de producto a agotar.
                        websiteId:
                          type: string
                          description: ID de la pagina web.
                        createAt:
                          type: string
                          format: date-time
                          description: Fecha en la que se creo.
                        stock:
                          type: integer
                          description: Valor numérico del stock.
        '207':
          description: Errores parciales
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    description: Indicador de la solicitud con el valor
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        _id:
                          type: string
                          description: ID del item.
                        store:
                          type: object
                          properties:
                            _id:
                              type: string
                              description: ID de la tienda.
                            name:
                              type: string
                              description: Nombre de la tienda.
                            externalId:
                              type: string
                              description: ID externo de la tienda.
                        modifier:    
                          type: object
                          properties:
                            _id:
                              type: string
                              description: ID del producto.
                            externalId:
                              type: string
                              description: ID externo de la empresa
                            name:
                              type: string
                              description: Nombre de la tienda.
                        type:
                          type: string
                          description: Tipo de producto a agotar.
                        websiteId:
                          type: string
                          description: ID de la pagina web.
                        createAt:
                          type: string
                          format: date-time
                          description: Fecha en la que se creo.
                        stock:
                          type: integer
                          description: Valor numérico del stock.
                        


        '400':
          description: Error en la solicitud, validaciones fallidas
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    description:  Indicador de la solicitud con el valor.
                  error:
                    type: string
                    description: Indicador de la razón del error.
                    example: Validations errors
                  data:
                    type: object
                    properties:
                      errors:
                        type: array
                        items:
                          type: object
                          properties:
                            items:
                              type: object
                              properties:
                                storeId:
                                  type: string
                                  description: ID de la tienda asociada.
                                productId:
                                  type: string
                                  description: ID del producto.
                                modifierId:
                                  type: string
                                  description: ID a modificar.
                                modifierOptionId:
                                  type: string
                                  description: ID a modificar.
                                type:
                                  type: string
                                  description: Tipo del producto.
                                stock:
                                  type: number
                                  description: Cantidad de stock. 
                            errors:
                              items:
                                type: string             
        '401':
          description: Access token is missing or invalid


  /updateStock:
    post:
      tags:
        - StockMethods
      summary: Actualizar stock de un producto
      description: Este endpoint tiene como finalidad definir, de manera unitaria o múltiple, el stock de productos o modificadores.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                type: object
                properties:
                  storeId:
                    type: string
                    description: ID del local. Se puede utilizar el `externalId`.
                  productId:
                    type: string
                    description: ID del Producto. Se puede utilizar el `externalId`.
                  modifierId:
                    type: string
                    description: ID del Modificador. Se puede utilizar el `externalId`.
                  modifierOptionId:
                    type: string
                    description: ID de la opción del Modificador. Se puede utilizar el `externalId`.
                  type:
                    type: string
                    description: Tipo de producto a agotar.
                    enum: [product, modifier]
                  stock:
                    type: integer
                    description: Valor numérico del stock. Requerido si `deleteItem` no está definido
                  deleteItem:
                    type: boolean
                    description: Valor boleano, solo en caso de que se quiera desagotar un producto o modificador. Requerido si `stock` no está definido
              required:
              - storeId
              - type
      responses:
        '200':
          description: Operacion exitosa
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    description: Estado de la operacion
                  data:
                    type: object
                    properties:
                      processId:
                        type: string
                        description: ID del item
        '400':
          description: Error en la solititud.
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    description: Estado de la operacion.
                  error:
                    type: string
                    description: Reason for the error.
                  data:
                    type: object
                    properties:
                      errors:
                        type: array
                        items:
                          type: object
                          properties:
                            item:
                              type: object
                              properties:
                                storeId:
                                  type: string
                                  description: ID de la tienda asociada
                                productId:
                                  type: string
                                  description: ID del producto.
                                modifierId:
                                  type: string
                                  description: Id a modificar.
                                modifierOptionId:
                                  type: string
                                  description: ID a modificar.
                                type:
                                  type: string
                                  description: Tipo del producto.
                                stock:
                                  type: integer
                                  description: Cantidad de stock
                            errors:
                              type: array
                              items:
                                type: string
        '401':
          description: Missing or invalid access token.
